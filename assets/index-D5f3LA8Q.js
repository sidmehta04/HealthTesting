const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-BqVngCnI.js","assets/common-vendor-Dm1O5F_f.js","assets/card-LNUWDAdH.js","assets/input-B4qfIMTe.js","assets/alert-HtEo9hhP.js","assets/firebase-vendor-DMyrRdrZ.js","assets/Dashboard-2tA42xN4.js","assets/table-BlATw8c5.js","assets/HealthCampForm-TQ-dGv5i.js","assets/tooltip-JWNWVOX-.js","assets/select-1Mx02fKa.js","assets/IndividualHealthCampForm-nKh_ijxW.js","assets/SuperAdminDashboard-D7bB9AFP.js","assets/Layout-C67EN4VW.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,H as Z,R as z,a as p,N as D,u as F,b as K,c as ee}from"./common-vendor-Dm1O5F_f.js";import{i as te,g as re,a as ne,o as se,s as k,r as A,b as C,c as y,d as $,e as ae}from"./firebase-vendor-DMyrRdrZ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))m(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&m(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function m(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();const oe="modulepreload",ie=function(r){return"/HealthTesting/"+r},V={},b=function(t,a,m){let n=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),h=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));n=Promise.allSettled(a.map(f=>{if(f=ie(f),f in V)return;V[f]=!0;const v=f.endsWith(".css"),N=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${N}`))return;const x=document.createElement("link");if(x.rel=v?"stylesheet":oe,v||(x.as="script"),x.crossOrigin="",x.href=f,h&&x.setAttribute("nonce",h),document.head.appendChild(x),v)return new Promise((P,R)=>{x.addEventListener("load",P),x.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${f}`)))})}))}function i(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return n.then(c=>{for(const h of c||[])h.status==="rejected"&&i(h.reason);return t().catch(i)})},ce={apiKey:"AIzaSyDu5-1Ka72C5CAwIVVT924uhrjJ20u0xeo",authDomain:"health-camptest.firebaseapp.com",databaseURL:"https://health-camptest-default-rtdb.firebaseio.com",projectId:"health-camptest",storageBucket:"health-camptest.firebasestorage.app",messagingSenderId:"30303192449",appId:"1:30303192449:web:61135972378bd7e5491480"},W=te(ce),j=re(W),L=ne(W),G=o.createContext();function O(){return o.useContext(G)}function le({children:r}){const[t,a]=o.useState(null),[m,n]=o.useState(null),[i,c]=o.useState(!0),[h,f]=o.useState(Date.now()),[v,N]=o.useState({}),x=30*60*1e3,P=5,R=15*60*1e3,w=async()=>{try{if(localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(s=>{document.cookie=s.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}),"caches"in window){const s=await caches.keys();await Promise.all(s.map(d=>caches.delete(d)))}}catch(s){console.error("Error clearing storage:",s)}},J=s=>{const d=v[s]||{count:0,timestamp:Date.now()},l=Date.now()-d.timestamp;if(l>R)return!0;if(d.count>=P)throw new Error(`Account temporarily locked. Please try again in ${Math.ceil((R-l)/6e4)} minutes.`);return!0},X=async s=>{try{await k(A(L,`users/${s}/lastActive`),C())}catch(d){console.error("Error updating user activity:",d)}};o.useEffect(()=>{const s=()=>{const u=Date.now();f(u),t!=null&&t.uid&&X(t.uid)},d=()=>{t&&Date.now()-h>x&&U()},l=["mousemove","keydown","click","scroll","touchstart"];l.forEach(u=>window.addEventListener(u,s));const g=setInterval(d,60*1e3);return()=>{l.forEach(u=>window.removeEventListener(u,s)),clearInterval(g)}},[t,h]);async function Y(s,d){try{if(!J(s))return;const l=await ae(j,s,d),g=A(L,`users/${l.user.uid}`),u=await $(g);if(!u.exists())throw console.error("No user data found in database"),await y(j),await w(),new Error("User not found in database");const I=u.val();if(!I.role)throw console.error("No role found for user"),await y(j),await w(),new Error("User role not found");return await k(A(L,`users/${l.user.uid}/status`),{lastLogin:C(),loginIP:await fetch("https://api.ipify.org?format=json").then(E=>E.json()).then(E=>E.ip),userAgent:navigator.userAgent}),N(E=>({...E,[s]:{count:0,timestamp:Date.now()}})),n(I.role),a({...l.user,role:I.role}),f(Date.now()),l}catch(l){throw N(g=>{var u;return{...g,[s]:{count:(((u=g[s])==null?void 0:u.count)||0)+1,timestamp:Date.now()}}}),console.error("Login error:",l),l}}async function U(){try{t!=null&&t.uid&&await k(A(L,`users/${t.uid}/status/lastLogout`),C()),await w(),await y(j),a(null),n(null)}catch(s){throw console.error("Logout error:",s),s}}o.useEffect(()=>{const s=se(j,async d=>{if(d)try{const l=A(L,`users/${d.uid}`),g=await $(l);if(g.exists()){const u=g.val();if(u.status==="blocked")throw await y(j),await w(),new Error("Account has been blocked. Please contact administrator.");n(u.role),a({...d,role:u.role}),f(Date.now())}else console.error("No user data found during auth state change"),await y(j),await w(),a(null),n(null)}catch(l){console.error("Error fetching user data:",l),await y(j),await w(),a(null),n(null)}else a(null),n(null),await w();c(!1)});return()=>{s(),w()}},[]);const Q={currentUser:t,userRole:m,login:Y,logout:U,loading:i,isAuthenticated:!!t,isSuperAdmin:m==="superadmin",isHealthCampAdmin:m==="health-camp-admin",isIndividualCampAdmin:m==="individual-camp-admin",lastActivity:h};return e.jsx(G.Provider,{value:Q,children:!i&&r})}const ue=o.lazy(()=>b(()=>import("./Login-BqVngCnI.js"),__vite__mapDeps([0,1,2,3,4,5]))),B=o.lazy(()=>b(()=>import("./Dashboard-2tA42xN4.js"),__vite__mapDeps([6,1,5,2,7,3]))),H=o.lazy(()=>b(()=>import("./HealthCampForm-TQ-dGv5i.js"),__vite__mapDeps([8,1,5,2,3,4,9,7,10]))),q=o.lazy(()=>b(()=>import("./IndividualHealthCampForm-nKh_ijxW.js"),__vite__mapDeps([11,1,5,2,9]))),de=o.lazy(()=>b(()=>import("./SuperAdminDashboard-D7bB9AFP.js"),__vite__mapDeps([12,1,5,2,10,7,6,3]))),he=o.lazy(()=>b(()=>import("./Layout-C67EN4VW.js"),__vite__mapDeps([13,1,5])));function _(){return e.jsx("div",{className:"w-full h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}function me(){const r=F();return e.jsx("div",{className:"w-full h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"w-full max-w-md mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900",children:"Unauthorized Access"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"You don't have permission to access this page."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>r(-1),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",children:"Go Back"})})]})})})}function fe(){const r=F();return e.jsx("div",{className:"w-full h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"w-full max-w-md mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900",children:"404 - Page Not Found"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"The page you're looking for doesn't exist."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>r(-1),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",children:"Go Back"})})]})})})}const M=async()=>{try{if(localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(r=>{document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}),"caches"in window){const r=await caches.keys();await Promise.all(r.map(t=>caches.delete(t)))}if("serviceWorker"in navigator){const r=await navigator.serviceWorker.getRegistrations();await Promise.all(r.map(t=>t.unregister()))}}catch(r){console.error("Error clearing browser data:",r)}};function S({children:r}){const{currentUser:t,loading:a}=O(),m=K();return o.useEffect(()=>{!t&&!a&&M()},[t,a]),a?e.jsx(_,{}):t?r:e.jsx(D,{to:"/login",state:{from:m.pathname},replace:!0})}function T({children:r,allowedRoles:t}){const{userRole:a,loading:m}=O(),n=K();return m?e.jsx(_,{}):t.includes(a)?r:e.jsx(D,{to:"/unauthorized",state:{from:n.pathname},replace:!0})}function pe(){const{currentUser:r,userRole:t}=O(),a=()=>{if(!r)return"/login";switch(t){case"superadmin":return"/superadmin";case"health-camp-admin":return"/health-camp";case"individual-camp-admin":return"/individual-health-camp";default:return"/dashboard"}};return e.jsx("div",{className:"w-full min-h-screen bg-gray-50",children:e.jsx(o.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(he,{children:e.jsxs(z,{children:[e.jsx(p,{path:"/login",element:r?e.jsx(D,{to:a(),replace:!0}):e.jsx(ue,{})}),e.jsx(p,{path:"/unauthorized",element:e.jsx(me,{})}),e.jsx(p,{path:"/",element:e.jsx(D,{to:a(),replace:!0})}),e.jsx(p,{path:"/dashboard",element:e.jsx(S,{children:e.jsx(B,{})})}),e.jsx(p,{path:"/superadmin/*",element:e.jsx(S,{children:e.jsx(T,{allowedRoles:["superadmin"],children:e.jsx(o.Suspense,{fallback:e.jsx(_,{}),children:e.jsxs(z,{children:[e.jsx(p,{index:!0,element:e.jsx(de,{})}),e.jsx(p,{path:"health-camp",element:e.jsx(H,{})}),e.jsx(p,{path:"individual-health-camp",element:e.jsx(q,{})}),e.jsx(p,{index:!0,element:e.jsx(B,{})})]})})})})}),e.jsx(p,{path:"/health-camp",element:e.jsx(S,{children:e.jsx(T,{allowedRoles:["health-camp-admin","superadmin"],children:e.jsx(H,{})})})}),e.jsx(p,{path:"/individual-health-camp",element:e.jsx(S,{children:e.jsx(T,{allowedRoles:["health-camp-admin","individual-camp-admin","superadmin"],children:e.jsx(q,{})})})}),e.jsx(p,{path:"*",element:e.jsx(fe,{})})]})})})})}function xe(){return o.useEffect(()=>{const r=()=>{M()};return window.addEventListener("beforeunload",r),window.addEventListener("unload",r),()=>{window.removeEventListener("beforeunload",r),window.removeEventListener("unload",r)}},[]),e.jsx(Z,{children:e.jsx(le,{children:e.jsx("div",{className:"w-full min-h-screen",children:e.jsx(o.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(pe,{})})})})})}ee.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(xe,{})}));export{L as d,O as u};
